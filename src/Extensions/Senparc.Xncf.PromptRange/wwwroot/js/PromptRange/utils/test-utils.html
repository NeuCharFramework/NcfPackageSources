<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥å…·ç±»æµ‹è¯• - PromptRange Utils</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #409EFF;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 3px solid #409EFF;
        }
        .success {
            color: #67C23A;
            font-weight: bold;
        }
        .error {
            color: #F56C6C;
            font-weight: bold;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #66b1ff;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª PromptRange Utils å·¥å…·ç±»æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1ï¸âƒ£ HTML Helper æµ‹è¯•</h2>
        <div id="htmlHelperTest"></div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ Date Helper æµ‹è¯•</h2>
        <div id="dateHelperTest"></div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ Name Helper æµ‹è¯•</h2>
        <div id="nameHelperTest"></div>
    </div>

    <div class="test-section">
        <h2>4ï¸âƒ£ Storage Helper æµ‹è¯•</h2>
        <div id="storageHelperTest"></div>
        <button onclick="testStorage()">æµ‹è¯• Storage</button>
    </div>

    <div class="test-section">
        <h2>5ï¸âƒ£ Copy Helper æµ‹è¯•</h2>
        <div id="copyHelperTest"></div>
        <button onclick="testCopy()">æµ‹è¯•å¤åˆ¶åŠŸèƒ½</button>
    </div>

    <div class="test-section">
        <h2>6ï¸âƒ£ å…¨å±€å‘½åç©ºé—´æ£€æŸ¥</h2>
        <div id="namespaceCheck"></div>
    </div>

    <!-- åŠ è½½å·¥å…·ç±» -->
    <script src="./htmlHelper.js"></script>
    <script src="./dateHelper.js"></script>
    <script src="./nameHelper.js"></script>
    <script src="./storageHelper.js"></script>
    <script src="./copyHelper.js"></script>

    <!-- æµ‹è¯•è„šæœ¬ -->
    <script>
        // è¾…åŠ©å‡½æ•°
        function addResult(containerId, label, result, isSuccess) {
            var container = document.getElementById(containerId);
            var div = document.createElement('div');
            div.className = 'test-item';
            div.innerHTML = '<strong>' + label + ':</strong> ' +
                '<span class="' + (isSuccess ? 'success' : 'error') + '">' +
                (isSuccess ? 'âœ“' : 'âœ—') + '</span> ' + result;
            container.appendChild(div);
        }

        function addResultWithValue(containerId, label, value, isSuccess) {
            addResult(containerId, label, '<br><pre>' + JSON.stringify(value, null, 2) + '</pre>', isSuccess);
        }

        // 1. æµ‹è¯• HTML Helper
        (function() {
            var HtmlHelper = window.PromptRangeUtils.HtmlHelper;
            
            // æµ‹è¯•è½¬ä¹‰
            var escapedText = HtmlHelper.escape('<script>alert("test")</script>');
            addResult('htmlHelperTest', 'HTML è½¬ä¹‰', escapedText, escapedText.indexOf('<') === -1);

            // æµ‹è¯• UUID ç”Ÿæˆ
            var uuid = HtmlHelper.generateUUID();
            addResult('htmlHelperTest', 'UUID ç”Ÿæˆ', uuid, uuid.length === 36);

            // æµ‹è¯•æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
            var size = HtmlHelper.formatFileSize(1024 * 1024);
            addResult('htmlHelperTest', 'æ–‡ä»¶å¤§å°æ ¼å¼åŒ– (1MB)', size, size === '1.00 MB');

            // æµ‹è¯•æ­£åˆ™è½¬ä¹‰
            var regexEscaped = HtmlHelper.escapeRegex('test.*');
            addResult('htmlHelperTest', 'æ­£åˆ™è½¬ä¹‰', regexEscaped, regexEscaped === 'test\\.\\*');

            // æµ‹è¯•ç©ºå€¼åˆ¤æ–­
            var isEmpty1 = HtmlHelper.isEmpty('');
            var isEmpty2 = HtmlHelper.isEmpty('text');
            addResult('htmlHelperTest', 'ç©ºå€¼åˆ¤æ–­', 'empty:"" = ' + isEmpty1 + ', "text" = ' + isEmpty2, isEmpty1 && !isEmpty2);
        })();

        // 2. æµ‹è¯• Date Helper
        (function() {
            var DateHelper = window.PromptRangeUtils.DateHelper;
            
            // æµ‹è¯•æ—¥æœŸæ ¼å¼åŒ–
            var now = new Date();
            var formatted = DateHelper.formatDate(now, 'YYYY-MM-DD HH:mm:ss');
            addResult('dateHelperTest', 'æ—¥æœŸæ ¼å¼åŒ–', formatted, formatted.length === 19);

            // æµ‹è¯•ç›¸å¯¹æ—¶é—´
            var recent = new Date(Date.now() - 5 * 60 * 1000); // 5åˆ†é’Ÿå‰
            var chatTime = DateHelper.formatChatTime(recent);
            addResult('dateHelperTest', 'ç›¸å¯¹æ—¶é—´ (5åˆ†é’Ÿå‰)', chatTime, chatTime.indexOf('åˆ†é’Ÿå‰') > -1);

            // æµ‹è¯•æ—¶é—´æˆ³
            var timestamp = DateHelper.getTimestamp();
            addResult('dateHelperTest', 'è·å–æ—¶é—´æˆ³', timestamp, timestamp > 0);

            // æµ‹è¯•æ˜¯å¦ä¸ºä»Šå¤©
            var isToday = DateHelper.isToday(new Date());
            addResult('dateHelperTest', 'æ˜¯å¦ä¸ºä»Šå¤©', isToday, isToday === true);

            // æµ‹è¯•æŒç»­æ—¶é—´æ ¼å¼åŒ–
            var duration = DateHelper.formatDuration(3665000); // 1å°æ—¶1åˆ†é’Ÿ5ç§’
            addResult('dateHelperTest', 'æŒç»­æ—¶é—´æ ¼å¼åŒ–', duration, duration.indexOf('å°æ—¶') > -1);
        })();

        // 3. æµ‹è¯• Name Helper
        (function() {
            var NameHelper = window.PromptRangeUtils.NameHelper;
            var testData = [
                {value: 1, label: 'é€‰é¡¹1'},
                {value: 2, label: 'é€‰é¡¹2'},
                {value: 3, label: 'é€‰é¡¹3'}
            ];
            
            // æµ‹è¯• getName
            var name = NameHelper.getName(testData, 2, 'æœªçŸ¥');
            addResult('nameHelperTest', 'getName (ID=2)', name, name === 'é€‰é¡¹2');

            // æµ‹è¯•æ‰¾ä¸åˆ°çš„æƒ…å†µ
            var notFound = NameHelper.getName(testData, 999, 'æœªæ‰¾åˆ°');
            addResult('nameHelperTest', 'getName (ä¸å­˜åœ¨çš„ID)', notFound, notFound === 'æœªæ‰¾åˆ°');

            // æµ‹è¯• getId
            var id = NameHelper.getId(testData, 'é€‰é¡¹2', null);
            addResult('nameHelperTest', 'getId', id, id === 2);

            // æµ‹è¯• hasId
            var has = NameHelper.hasId(testData, 2);
            var notHas = NameHelper.hasId(testData, 999);
            addResult('nameHelperTest', 'hasId', 'ID=2: ' + has + ', ID=999: ' + notHas, has && !notHas);

            // æµ‹è¯•æ‰¹é‡è·å–
            var names = NameHelper.getNames(testData, [1, 2, 3]);
            addResult('nameHelperTest', 'æ‰¹é‡è·å–åç§°', names.join(', '), names.length === 3);
        })();

        // 4. æµ‹è¯• Storage Helper
        function testStorage() {
            var StorageHelper = window.PromptRangeUtils.StorageHelper;
            var container = document.getElementById('storageHelperTest');
            container.innerHTML = '';
            
            // æµ‹è¯•æ˜¯å¦å¯ç”¨
            var isAvailable = StorageHelper.isAvailable();
            addResult('storageHelperTest', 'Storage å¯ç”¨æ€§', isAvailable, isAvailable);

            // æµ‹è¯•ä¿å­˜å’Œè¯»å–
            var testData = {name: 'Test', value: 123, arr: [1, 2, 3]};
            var saved = StorageHelper.set('test_key', testData);
            addResult('storageHelperTest', 'ä¿å­˜æ•°æ®', saved, saved);

            var retrieved = StorageHelper.get('test_key');
            addResult('storageHelperTest', 'è¯»å–æ•°æ®', JSON.stringify(retrieved), 
                retrieved && retrieved.name === 'Test' && retrieved.value === 123);

            // æµ‹è¯• has
            var exists = StorageHelper.has('test_key');
            addResult('storageHelperTest', 'æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨', exists, exists);

            // æµ‹è¯•åˆ é™¤
            StorageHelper.remove('test_key');
            var afterRemove = StorageHelper.has('test_key');
            addResult('storageHelperTest', 'åˆ é™¤åæ£€æŸ¥', 'å·²åˆ é™¤', !afterRemove);

            // æµ‹è¯•å­˜å‚¨ä¿¡æ¯
            var info = StorageHelper.getStorageInfo();
            addResultWithValue('storageHelperTest', 'å­˜å‚¨ä¿¡æ¯', info, true);
        }

        // 5. æµ‹è¯• Copy Helper
        function testCopy() {
            var CopyHelper = window.PromptRangeUtils.CopyHelper;
            var container = document.getElementById('copyHelperTest');
            container.innerHTML = '';
            
            // æµ‹è¯•æ˜¯å¦æ”¯æŒ
            var supported = CopyHelper.isSupported();
            addResult('copyHelperTest', 'å¤åˆ¶åŠŸèƒ½æ”¯æŒ', supported, supported);

            // æµ‹è¯•å¤åˆ¶æ–‡æœ¬
            var copySuccess = CopyHelper.copyToClipboard('æµ‹è¯•æ–‡æœ¬', 'å¤åˆ¶æˆåŠŸï¼', 'å¤åˆ¶å¤±è´¥ï¼', false);
            addResult('copyHelperTest', 'å¤åˆ¶æ–‡æœ¬', 'å·²å°è¯•å¤åˆ¶ "æµ‹è¯•æ–‡æœ¬"', true);

            // æµ‹è¯•å¤åˆ¶å¯¹è±¡
            var obj = {test: 'value', number: 123};
            CopyHelper.copyObject(obj, 2);
            addResult('copyHelperTest', 'å¤åˆ¶å¯¹è±¡ (JSON)', 'å·²å°è¯•å¤åˆ¶å¯¹è±¡', true);

            // æµ‹è¯•å¤åˆ¶æ•°ç»„
            var arr = ['é¡¹ç›®1', 'é¡¹ç›®2', 'é¡¹ç›®3'];
            CopyHelper.copyArray(arr, '\n');
            addResult('copyHelperTest', 'å¤åˆ¶æ•°ç»„', 'å·²å°è¯•å¤åˆ¶æ•°ç»„', true);
        }

        // 6. æ£€æŸ¥å…¨å±€å‘½åç©ºé—´
        (function() {
            var container = document.getElementById('namespaceCheck');
            var utils = window.PromptRangeUtils;
            
            if (utils) {
                var helpers = ['HtmlHelper', 'DateHelper', 'NameHelper', 'StorageHelper', 'CopyHelper'];
                var allLoaded = true;
                
                helpers.forEach(function(name) {
                    var exists = !!utils[name];
                    addResult('namespaceCheck', name, exists ? 'å·²åŠ è½½' : 'æœªåŠ è½½', exists);
                    if (!exists) allLoaded = false;
                });

                if (allLoaded) {
                    container.innerHTML = '<div class="test-item" style="background: #f0f9ff; border-color: #67C23A;">' +
                        '<strong class="success">âœ“ æ‰€æœ‰å·¥å…·ç±»å·²æˆåŠŸåŠ è½½åˆ° window.PromptRangeUtils å‘½åç©ºé—´ï¼</strong></div>' +
                        container.innerHTML;
                }
            } else {
                addResult('namespaceCheck', 'å‘½åç©ºé—´', 'æœªæ‰¾åˆ° window.PromptRangeUtils', false);
            }
        })();

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        console.log('%cå·¥å…·ç±»æµ‹è¯•é¡µé¢å·²åŠ è½½', 'color: green; font-size: 16px; font-weight: bold;');
        console.log('window.PromptRangeUtils:', window.PromptRangeUtils);
    </script>
</body>
</html>

