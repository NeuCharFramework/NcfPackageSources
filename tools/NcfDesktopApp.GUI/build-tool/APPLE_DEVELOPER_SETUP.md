# ğŸ Apple å¼€å‘è€…è´¦å·é…ç½®æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [æ³¨å†Œ Apple å¼€å‘è€…è´¦å·](#1-æ³¨å†Œ-apple-å¼€å‘è€…è´¦å·)
2. [é…ç½®è¯ä¹¦å’Œå¯†é’¥](#2-é…ç½®è¯ä¹¦å’Œå¯†é’¥)
3. [åœ¨è„šæœ¬ä¸­ä½¿ç”¨ç­¾å](#3-åœ¨è„šæœ¬ä¸­ä½¿ç”¨ç­¾å)
4. [å…¬è¯åº”ç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰](#4-å…¬è¯åº”ç”¨ç¨‹åºå¯é€‰)
5. [å¸¸è§é—®é¢˜](#5-å¸¸è§é—®é¢˜)

---

## 1. æ³¨å†Œ Apple å¼€å‘è€…è´¦å·

### 1.1 è®¿é—®æ³¨å†Œé¡µé¢

1. è®¿é—® [Apple Developer å®˜ç½‘](https://developer.apple.com/)
2. ç‚¹å‡»å³ä¸Šè§’ **"Account"** æˆ– **"Enroll"**
3. ä½¿ç”¨æ‚¨çš„ Apple ID ç™»å½•ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å…ˆåˆ›å»ºï¼‰

### 1.2 é€‰æ‹©è´¦å·ç±»å‹

**ä¸ªäººå¼€å‘è€…è´¦å·**ï¼š
- ğŸ’° **è´¹ç”¨**ï¼š$99/å¹´ï¼ˆçº¦ Â¥688/å¹´ï¼‰
- âœ… **é€‚åˆ**ï¼šä¸ªäººå¼€å‘è€…ã€å°å‹é¡¹ç›®
- ğŸ“ **éœ€è¦**ï¼šèº«ä»½è¯æˆ–æŠ¤ç…§éªŒè¯

**ä¼ä¸šå¼€å‘è€…è´¦å·**ï¼š
- ğŸ’° **è´¹ç”¨**ï¼š$299/å¹´ï¼ˆçº¦ Â¥2,088/å¹´ï¼‰
- âœ… **é€‚åˆ**ï¼šå…¬å¸ã€ç»„ç»‡
- ğŸ“ **éœ€è¦**ï¼šå…¬å¸è¥ä¸šæ‰§ç…§ã€DUNS ç¼–å·

**æ¨è**ï¼šå¯¹äºå¤§å¤šæ•°å¼€å‘è€…ï¼Œ**ä¸ªäººå¼€å‘è€…è´¦å·**å·²ç»è¶³å¤Ÿã€‚

### 1.3 å®Œæˆæ³¨å†Œæµç¨‹

1. **å¡«å†™ä¸ªäººä¿¡æ¯**
   - å§“åã€åœ°å€ã€è”ç³»æ–¹å¼
   - æ”¯ä»˜ä¿¡æ¯ï¼ˆä¿¡ç”¨å¡ï¼‰

2. **éªŒè¯èº«ä»½**
   - ä¸Šä¼ èº«ä»½è¯æˆ–æŠ¤ç…§ç…§ç‰‡
   - ç­‰å¾… Apple å®¡æ ¸ï¼ˆé€šå¸¸ 24-48 å°æ—¶ï¼‰

3. **æ¿€æ´»è´¦å·**
   - æ”¶åˆ°ç¡®è®¤é‚®ä»¶åï¼Œç™»å½• [Apple Developer Portal](https://developer.apple.com/account/)
   - æ¥å—å¼€å‘è€…åè®®

---

## 2. é…ç½®è¯ä¹¦å’Œå¯†é’¥

### 2.1 åˆ›å»º App-Specific Passwordï¼ˆç”¨äºå…¬è¯ï¼‰

å¦‚æœéœ€è¦è¿›è¡Œå…¬è¯ï¼ˆNotarizationï¼‰ï¼Œéœ€è¦åˆ›å»º App-Specific Passwordï¼š

1. è®¿é—® [Apple ID è´¦æˆ·é¡µé¢](https://appleid.apple.com/)
2. ç™»å½•åï¼Œè¿›å…¥ **"App-Specific Passwords"** éƒ¨åˆ†
3. ç‚¹å‡» **"Generate Password"**
4. è¾“å…¥æ ‡ç­¾ï¼ˆå¦‚ "Notarization"ï¼‰
5. å¤åˆ¶ç”Ÿæˆçš„å¯†ç ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·å¦¥å–„ä¿å­˜ï¼‰

### 2.2 å®‰è£… Xcode Command Line Tools

```bash
# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
xcode-select -p

# å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
xcode-select --install
```

### 2.3 åˆ›å»ºè¯ä¹¦ï¼ˆè‡ªåŠ¨æ–¹å¼ - æ¨èï¼‰

ä½¿ç”¨ Xcode è‡ªåŠ¨ç®¡ç†è¯ä¹¦ï¼ˆæœ€ç®€å•ï¼‰ï¼š

1. æ‰“å¼€ **Xcode**
2. è¿›å…¥ **Preferences** > **Accounts**
3. ç‚¹å‡» **"+"** æ·»åŠ æ‚¨çš„ Apple ID
4. é€‰æ‹©æ‚¨çš„è´¦å·ï¼Œç‚¹å‡» **"Manage Certificates"**
5. ç‚¹å‡» **"+"** é€‰æ‹© **"Developer ID Application"**
6. Xcode ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶ä¸‹è½½è¯ä¹¦åˆ°é’¥åŒ™ä¸²

### 2.4 åˆ›å»ºè¯ä¹¦ï¼ˆæ‰‹åŠ¨æ–¹å¼ï¼‰

å¦‚æœéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š

1. ç™»å½• [Apple Developer Portal](https://developer.apple.com/account/)
2. è¿›å…¥ **Certificates, Identifiers & Profiles**
3. ç‚¹å‡» **Certificates** > **"+"**
4. é€‰æ‹© **Developer ID Application**ï¼ˆç”¨äºåˆ†å‘åˆ° Mac App Store å¤–ï¼‰
5. æŒ‰ç…§å‘å¯¼åˆ›å»ºè¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰ï¼š
   ```bash
   # åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ
   openssl req -new -newkey rsa:2048 -nodes -keyout private_key.pem -out certificate_request.csr
   ```
6. ä¸Šä¼  CSR æ–‡ä»¶ï¼Œä¸‹è½½è¯ä¹¦
7. åŒå‡»ä¸‹è½½çš„è¯ä¹¦æ–‡ä»¶ï¼Œå¯¼å…¥åˆ°é’¥åŒ™ä¸²

### 2.5 éªŒè¯è¯ä¹¦å®‰è£…

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ä»£ç ç­¾åè¯ä¹¦
security find-identity -v -p codesigning

# åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
# 1) ABC123DEF456 "Developer ID Application: Your Name (TEAM_ID)"
#      1 valid identities found
```

**é‡è¦**ï¼šè®°ä¸‹è¯ä¹¦çš„å®Œæ•´åç§°ï¼ˆåŒ…æ‹¬å¼•å·å†…çš„å†…å®¹ï¼‰ï¼Œåç»­ä¼šç”¨åˆ°ã€‚

---

## 3. åœ¨è„šæœ¬ä¸­ä½¿ç”¨ç­¾å

### 3.1 åŸºæœ¬ç­¾åï¼ˆè‡ªåŠ¨æŸ¥æ‰¾è¯ä¹¦ï¼‰

è„šæœ¬ä¼šè‡ªåŠ¨æŸ¥æ‰¾ç³»ç»Ÿä¸­çš„ "Developer ID Application" è¯ä¹¦ï¼š

```bash
# è‡ªåŠ¨æŸ¥æ‰¾å¹¶ä½¿ç”¨è¯ä¹¦ç­¾å
./build-tool/create-macos-app.sh --sign --create-dmg
```

### 3.2 æŒ‡å®šç­¾åèº«ä»½

å¦‚æœç³»ç»Ÿä¸­æœ‰å¤šä¸ªè¯ä¹¦ï¼Œæˆ–éœ€è¦æŒ‡å®šç‰¹å®šè¯ä¹¦ï¼š

```bash
# æŸ¥çœ‹å¯ç”¨çš„ç­¾åèº«ä»½
security find-identity -v -p codesigning

# ä½¿ç”¨æŒ‡å®šçš„ç­¾åèº«ä»½
./build-tool/create-macos-app.sh \
    --sign \
    --identity "Developer ID Application: Your Name (TEAM_ID)" \
    --create-dmg
```

**æ³¨æ„**ï¼šç­¾åèº«ä»½åç§°å¿…é¡»å®Œå…¨åŒ¹é…ï¼ŒåŒ…æ‹¬å¼•å·ã€‚

### 3.3 éªŒè¯ç­¾å

ç­¾åå®Œæˆåï¼ŒéªŒè¯ç­¾åæ˜¯å¦æˆåŠŸï¼š

```bash
# éªŒè¯åº”ç”¨ç¨‹åºåŒ…çš„ç­¾å
codesign -dv --verbose=4 "macos-app/NCF Desktop-Universal.app"

# æ£€æŸ¥ç­¾åè¯¦ç»†ä¿¡æ¯
codesign --display --verbose=2 "macos-app/NCF Desktop-Universal.app"

# éªŒè¯ç­¾åæœ‰æ•ˆæ€§
spctl --assess --verbose "macos-app/NCF Desktop-Universal.app"
```

**æˆåŠŸæ ‡å¿—**ï¼š
- `codesign` è¾“å‡ºæ˜¾ç¤ºç­¾åä¿¡æ¯
- `spctl` è¿”å› `accepted` æˆ– `source=Developer ID`

---

## 4. å…¬è¯åº”ç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰

å…¬è¯ï¼ˆNotarizationï¼‰æ˜¯ Apple çš„é¢å¤–å®‰å…¨éªŒè¯ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºé€šè¿‡ Gatekeeper æ£€æŸ¥ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨å…è®¸ã€‚

### 4.1 é…ç½®å…¬è¯å‡­æ®

åˆ›å»º `~/.appstoreconnect/private_keys` ç›®å½•å¹¶é…ç½®ï¼š

```bash
# åˆ›å»ºç›®å½•
mkdir -p ~/.appstoreconnect/private_keys

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ ~/.zshrc æˆ– ~/.bash_profile ä¸­æ·»åŠ ï¼‰
export APPLE_ID="your-apple-id@example.com"
export APPLE_APP_SPECIFIC_PASSWORD="your-app-specific-password"
export APPLE_TEAM_ID="YOUR_TEAM_ID"  # ä» Apple Developer Portal è·å–
```

**è·å– Team ID**ï¼š
1. ç™»å½• [Apple Developer Portal](https://developer.apple.com/account/)
2. åœ¨å³ä¸Šè§’å¯ä»¥çœ‹åˆ° **Team ID**ï¼ˆæ ¼å¼ï¼šABC123DEF4ï¼‰

### 4.2 æ‰§è¡Œå…¬è¯

```bash
# ç­¾åå¹¶å…¬è¯åº”ç”¨ç¨‹åº
./build-tool/create-macos-app.sh --sign --notarize --create-dmg
```

**æ³¨æ„**ï¼šå½“å‰è„šæœ¬ç‰ˆæœ¬å¯èƒ½è¿˜æ²¡æœ‰å®Œå…¨å®ç°å…¬è¯åŠŸèƒ½ã€‚å¦‚æœéœ€è¦æ‰‹åŠ¨å…¬è¯ï¼š

```bash
# 1. å…ˆç­¾å
./build-tool/create-macos-app.sh --sign --create-dmg

# 2. åˆ›å»º zip æ–‡ä»¶ï¼ˆå…¬è¯éœ€è¦ï¼‰
cd macos-app
zip -r "NCF Desktop.zip" "NCF Desktop-Universal.app"

# 3. æäº¤å…¬è¯
xcrun notarytool submit "NCF Desktop.zip" \
    --apple-id "$APPLE_ID" \
    --password "$APPLE_APP_SPECIFIC_PASSWORD" \
    --team-id "$APPLE_TEAM_ID" \
    --wait

# 4. è£…è®¢å…¬è¯ç¥¨æ®ï¼ˆStapleï¼‰
xcrun stapler staple "NCF Desktop-Universal.app"
```

### 4.3 éªŒè¯å…¬è¯çŠ¶æ€

```bash
# æ£€æŸ¥å…¬è¯çŠ¶æ€
spctl --assess --verbose --type execute "macos-app/NCF Desktop-Universal.app"

# åº”è¯¥æ˜¾ç¤ºï¼šaccepted source=Notarized Developer ID
```

---

## 5. å¸¸è§é—®é¢˜

### Q1: æç¤º "æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç­¾åèº«ä»½"

**åŸå› **ï¼šç³»ç»Ÿä¸­æ²¡æœ‰å®‰è£… "Developer ID Application" è¯ä¹¦ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å·²æ³¨å†Œ Apple å¼€å‘è€…è´¦å·
2. åœ¨ Xcode ä¸­åˆ›å»ºè¯ä¹¦ï¼ˆæ¨èï¼‰ï¼š
   - Xcode > Preferences > Accounts > Manage Certificates
   - ç‚¹å‡» "+" > "Developer ID Application"
3. æˆ–æ‰‹åŠ¨ä» Apple Developer Portal ä¸‹è½½è¯ä¹¦

### Q2: ç­¾ååä»ç„¶æ˜¾ç¤ºå®‰å…¨è­¦å‘Š

**å¯èƒ½åŸå› **ï¼š
- ä½¿ç”¨äº† ad-hoc ç­¾åï¼ˆ`-`ï¼‰è€Œä¸æ˜¯å¼€å‘è€…è¯ä¹¦
- è¯ä¹¦å·²è¿‡æœŸ
- åº”ç”¨ç¨‹åºè¢«ä¿®æ”¹åæœªé‡æ–°ç­¾å

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç­¾åçŠ¶æ€
codesign -dv --verbose=4 "macos-app/NCF Desktop-Universal.app"

# é‡æ–°ç­¾å
codesign --force --deep --sign "Developer ID Application: Your Name" \
    "macos-app/NCF Desktop-Universal.app"
```

### Q3: è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç™»å½• [Apple Developer Portal](https://developer.apple.com/account/)
2. è¿›å…¥ Certificates é¡µé¢
3. åˆ›å»ºæ–°çš„ "Developer ID Application" è¯ä¹¦
4. ä¸‹è½½å¹¶å®‰è£…æ–°è¯ä¹¦
5. ä½¿ç”¨æ–°è¯ä¹¦é‡æ–°ç­¾ååº”ç”¨ç¨‹åº

### Q4: å¦‚ä½•æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸï¼Ÿ

```bash
# æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯
security find-identity -v -p codesigning

# æŸ¥çœ‹é’¥åŒ™ä¸²ä¸­çš„è¯ä¹¦
open /Applications/Utilities/Keychain\ Access.app
# åœ¨å·¦ä¾§é€‰æ‹© "login" > "My Certificates"
# æ‰¾åˆ°æ‚¨çš„è¯ä¹¦ï¼ŒåŒå‡»æŸ¥çœ‹æœ‰æ•ˆæœŸ
```

### Q5: å…¬è¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**å¸¸è§é”™è¯¯**ï¼š

1. **"Invalid credentials"**
   - æ£€æŸ¥ App-Specific Password æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ Apple ID å’Œ Team ID æ­£ç¡®

2. **"The signature is invalid"**
   - ç¡®ä¿åº”ç”¨ç¨‹åºå·²æ­£ç¡®ç­¾å
   - æ£€æŸ¥æ‰€æœ‰åµŒå¥—çš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½å·²ç­¾å

3. **"The executable is missing"**
   - ç¡®è®¤åº”ç”¨ç¨‹åºåŒ…ç»“æ„å®Œæ•´
   - æ£€æŸ¥ Info.plist ä¸­çš„ CFBundleExecutable è®¾ç½®

**è°ƒè¯•æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
xcrun notarytool log <submission-id> \
    --apple-id "$APPLE_ID" \
    --password "$APPLE_APP_SPECIFIC_PASSWORD" \
    --team-id "$APPLE_TEAM_ID"
```

### Q6: è´¹ç”¨æ˜¯å¤šå°‘ï¼Ÿ

- **ä¸ªäººå¼€å‘è€…è´¦å·**ï¼š$99/å¹´ï¼ˆçº¦ Â¥688/å¹´ï¼‰
- **ä¼ä¸šå¼€å‘è€…è´¦å·**ï¼š$299/å¹´ï¼ˆçº¦ Â¥2,088/å¹´ï¼‰

**æ³¨æ„**ï¼šè´¹ç”¨æŒ‰å¹´æ”¶å–ï¼Œè‡ªåŠ¨ç»­è´¹ã€‚

### Q7: å…è´¹è´¦å·å¯ä»¥ç­¾åå—ï¼Ÿ

**ä¸å¯ä»¥**ã€‚åªæœ‰ä»˜è´¹çš„ Apple å¼€å‘è€…è´¦å·æ‰èƒ½ï¼š
- åˆ›å»º "Developer ID Application" è¯ä¹¦
- è¿›è¡Œä»£ç ç­¾å
- æäº¤å…¬è¯

å…è´¹ Apple ID åªèƒ½ç”¨äºï¼š
- åœ¨ Xcode ä¸­å¼€å‘å’Œæµ‹è¯•
- åœ¨ä¸ªäººè®¾å¤‡ä¸Šå®‰è£…æµ‹è¯•åº”ç”¨ï¼ˆéœ€è¦è®¾å¤‡æ³¨å†Œï¼‰

---

## ğŸ“š ç›¸å…³èµ„æº

- [Apple Developer å®˜ç½‘](https://developer.apple.com/)
- [Apple Developer Portal](https://developer.apple.com/account/)
- [ä»£ç ç­¾åæ–‡æ¡£](https://developer.apple.com/documentation/security/code_signing_services)
- [å…¬è¯æ–‡æ¡£](https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution)
- [è¯ä¹¦ç®¡ç†æŒ‡å—](https://developer.apple.com/support/certificates/)

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### å®Œæ•´ç­¾åæµç¨‹

```bash
# 1. æ„å»ºåº”ç”¨ç¨‹åº
./build-tool/build-all-platforms-self-contained.sh -p osx-arm64
./build-tool/build-all-platforms-self-contained.sh -p osx-x64

# 2. åˆ›å»ºå¹¶ç­¾ååº”ç”¨ç¨‹åºåŒ…
./build-tool/create-macos-app.sh \
    --sign \
    --identity "Developer ID Application: Your Name (TEAM_ID)" \
    --create-dmg \
    --clean

# 3. éªŒè¯ç­¾å
codesign -dv --verbose=4 "macos-app/NCF Desktop-Universal.app"
spctl --assess --verbose "macos-app/NCF Desktop-Universal.app"

# 4. ï¼ˆå¯é€‰ï¼‰å…¬è¯
xcrun notarytool submit "macos-app/NCF Desktop.zip" \
    --apple-id "$APPLE_ID" \
    --password "$APPLE_APP_SPECIFIC_PASSWORD" \
    --team-id "$APPLE_TEAM_ID" \
    --wait
```

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šNCF Desktop App v1.0.0+



