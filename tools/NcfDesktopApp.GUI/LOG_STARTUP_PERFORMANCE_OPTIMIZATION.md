# æ—¥å¿—å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

## ðŸŽ¯ é—®é¢˜æè¿°

UIä¸ŠåŒæ­¥consoleæ—¥å¿—ä¼šå¯¼è‡´åŠ è½½é€Ÿåº¦å˜æ…¢ã€‚å®žé™…ä¸Šæ—¥å¿—å‡ ç§’é’Ÿå°±åŠ è½½å®Œäº†ï¼Œé©¬ä¸Šå°±å¯ä»¥å¯åŠ¨ï¼Œä½†æ˜¯çŽ°åœ¨éœ€è¦ç­‰å¾…æ—¥å¿—åŠ è½½å®Œï¼ŒèŠ±å¾ˆä¹…çš„æ—¶é—´ï¼Œå› ä¸ºæ—¥å¿—è¡Œæ•°å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ˜¯åœ¨çŸ­æ—¶é—´å†…å®Œæˆçš„ã€‚

## ðŸ” é—®é¢˜åˆ†æž

### åŽŸæœ‰å®žçŽ°çš„é—®é¢˜ï¼š
1. **å¯åŠ¨æ—¶ç«‹å³æ˜¾ç¤ºæ—¥å¿—**ï¼šåº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰æ—¥å¿—éƒ½ä¼šç«‹å³æ¸²æŸ“åˆ°UI
2. **é¢‘ç¹çš„UIæ›´æ–°**ï¼šæ¯100msæ›´æ–°ä¸€æ¬¡ï¼Œæ¯æ¬¡éƒ½è¦æž„å»ºæ•´ä¸ªæ—¥å¿—å­—ç¬¦ä¸²
3. **å¤§é‡æ—¥å¿—é˜»å¡žUI**ï¼šå½“æœ‰å‡ åƒè¡Œæ—¥å¿—æ—¶ï¼Œ`_logBuffer.ToString()` å’Œ UI æ¸²æŸ“ä¼šé˜»å¡žä¸»çº¿ç¨‹

### æ€§èƒ½ç“¶é¢ˆï¼š
- æ—¥å¿—åœ¨åŽå°å‡ ç§’é’Ÿå°±äº§ç”Ÿå®Œäº†ï¼ˆéƒ½è¿›å…¥äº†é˜Ÿåˆ—ï¼‰
- ä½†UIéœ€è¦ç­‰å¾…æ‰€æœ‰æ—¥å¿—éƒ½æ¸²æŸ“å®Œæ‰èƒ½ç»§ç»­
- æ¯æ¬¡æ›´æ–°éƒ½è¦æž„å»ºæ•´ä¸ªæ—¥å¿—å­—ç¬¦ä¸²ï¼ˆå‡ åƒè¡Œï¼‰ï¼Œå¯¼è‡´UIé˜»å¡ž

## âœ¨ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å»¶è¿Ÿæ—¥å¿—æ˜¾ç¤º
- **åº”ç”¨å¯åŠ¨é˜¶æ®µ**ï¼šæ—¥å¿—åªç´¯ç§¯åˆ°ç¼“å†²åŒºï¼Œä¸æ›´æ–°UI
- **åº”ç”¨å°±ç»ªåŽ**ï¼šæ‰å¼€å§‹æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—
- **æ•ˆæžœ**ï¼šåº”ç”¨å¯åŠ¨ä¸å†è¢«æ—¥å¿—æ¸²æŸ“é˜»å¡ž

### 2. é™åˆ¶åˆå§‹æ˜¾ç¤ºè¡Œæ•°
- **åˆå§‹æ˜¾ç¤ºé™åˆ¶**ï¼šåº”ç”¨å°±ç»ªåŽï¼Œå¦‚æžœæ—¥å¿—è¶…è¿‡200è¡Œï¼Œåªæ˜¾ç¤ºæœ€åŽ200è¡Œ
- **æç¤ºä¿¡æ¯**ï¼šæ˜¾ç¤º `[å·²è·³è¿‡ X è¡Œå¯åŠ¨æ—¥å¿—ï¼Œä»…æ˜¾ç¤ºæœ€åŽ 200 è¡Œ]`
- **æ•ˆæžœ**ï¼šé¿å…ä¸€æ¬¡æ€§æ¸²æŸ“å¤ªå¤šæ—¥å¿—ï¼Œå¿«é€Ÿæ˜¾ç¤ºæœ€æ–°å†…å®¹

### 3. åŠ¨æ€è°ƒæ•´æ›´æ–°é¢‘çŽ‡
- **æ­£å¸¸æƒ…å†µ**ï¼šæ¯100msæ›´æ–°ä¸€æ¬¡
- **æ—¥å¿—é‡å¤§æ—¶**ï¼šå¦‚æžœé˜Ÿåˆ—ä¸­æœ‰è¶…è¿‡50æ¡æ—¥å¿—ï¼Œä¸”è·ç¦»ä¸Šæ¬¡æ›´æ–°æ—¶é—´å°äºŽ500msï¼Œè·³è¿‡æœ¬æ¬¡æ›´æ–°
- **æ•ˆæžœ**ï¼šå½“æ—¥å¿—é‡å¾ˆå¤§æ—¶ï¼Œé™ä½Žæ›´æ–°é¢‘çŽ‡ï¼Œå‡å°‘UIé˜»å¡ž

## ðŸ”§ æŠ€æœ¯å®žçŽ°

### æ–°å¢žå­—æ®µï¼š
```csharp
private bool _isApplicationReady = false;  // åº”ç”¨æ˜¯å¦å·²å°±ç»ª
private DateTime _lastLogUpdateTime = DateTime.MinValue;  // ä¸Šæ¬¡æ—¥å¿—æ›´æ–°æ—¶é—´
private const int InitialDisplayLines = 200;  // åˆå§‹åªæ˜¾ç¤ºæœ€åŽ200è¡Œ
private const int MaxLogUpdateIntervalMs = 500;  // å½“æ—¥å¿—é‡å¤§æ—¶çš„æœ€å¤§æ›´æ–°é—´éš”
```

### å…³é”®é€»è¾‘ï¼š

#### 1. åº”ç”¨å¯åŠ¨é˜¶æ®µï¼ˆæœªå°±ç»ªï¼‰
```csharp
if (!_isApplicationReady)
{
    // åªç´¯ç§¯æ—¥å¿—åˆ°ç¼“å†²åŒºï¼Œä¸æ›´æ–°UI
    foreach (var log in logsToAdd)
    {
        _logBuffer.AppendLine(log);
        _currentLineCount++;
    }
    return;  // ä¸æ›´æ–°UI
}
```

#### 2. åº”ç”¨å°±ç»ªåŽ
```csharp
// æ ‡è®°åº”ç”¨å·²å°±ç»ª
_isApplicationReady = true;
// ç«‹å³åˆ·æ–°ä¸€æ¬¡æ—¥å¿—æ˜¾ç¤ºï¼ˆåªæ˜¾ç¤ºæœ€åŽ200è¡Œï¼‰
FlushPendingLogs();
```

#### 3. åŠ¨æ€è°ƒæ•´æ›´æ–°é¢‘çŽ‡
```csharp
// å¦‚æžœæ—¥å¿—é‡å¾ˆå¤§ä¸”è·ç¦»ä¸Šæ¬¡æ›´æ–°æ—¶é—´å¾ˆçŸ­ï¼Œè·³è¿‡æœ¬æ¬¡æ›´æ–°
if (pendingCount > 50 && timeSinceLastUpdate < MaxLogUpdateIntervalMs)
{
    // å°†æ—¥å¿—é‡æ–°æ”¾å›žé˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡æ›´æ–°
    lock (_pendingCliLogs)
    {
        foreach (var log in logsToAdd)
        {
            _pendingCliLogs.Enqueue(log);
        }
    }
    return;
}
```

## ðŸ“Š æ€§èƒ½æå‡

### ä¼˜åŒ–å‰ï¼š
- âŒ å¯åŠ¨æ—¶éœ€è¦ç­‰å¾…æ‰€æœ‰æ—¥å¿—æ¸²æŸ“å®Œ
- âŒ å‡ åƒè¡Œæ—¥å¿—ä¸€æ¬¡æ€§æ¸²æŸ“ï¼ŒUIé˜»å¡žä¸¥é‡
- âŒ å¯åŠ¨æ—¶é—´ï¼š5-10ç§’ï¼ˆå–å†³äºŽæ—¥å¿—é‡ï¼‰

### ä¼˜åŒ–åŽï¼š
- âœ… å¯åŠ¨æ—¶æ—¥å¿—åœ¨åŽå°ç´¯ç§¯ï¼Œä¸é˜»å¡žUI
- âœ… åªæ˜¾ç¤ºæœ€åŽ200è¡Œï¼Œå¿«é€Ÿæ˜¾ç¤ºæœ€æ–°å†…å®¹
- âœ… å¯åŠ¨æ—¶é—´ï¼š<1ç§’ï¼ˆå‡ ä¹Žç«‹å³å¯åŠ¨ï¼‰

## ðŸŽ‰ ç”¨æˆ·ä½“éªŒæ”¹è¿›

1. **å¿«é€Ÿå¯åŠ¨**ï¼šåº”ç”¨å‡ ä¹Žç«‹å³å¯åŠ¨ï¼Œä¸å†ç­‰å¾…æ—¥å¿—æ¸²æŸ“
2. **æœ€æ–°æ—¥å¿—ä¼˜å…ˆ**ï¼šåªæ˜¾ç¤ºæœ€åŽ200è¡Œï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯æœ€æ–°ã€æœ€é‡è¦çš„æ—¥å¿—
3. **å®Œæ•´æ—¥å¿—ä¿ç•™**ï¼šæ‰€æœ‰æ—¥å¿—éƒ½ä¿ç•™åœ¨ç¼“å†²åŒºä¸­ï¼Œåªæ˜¯åˆå§‹ä¸æ˜¾ç¤º
4. **å¹³æ»‘æ›´æ–°**ï¼šåº”ç”¨å°±ç»ªåŽï¼Œæ—¥å¿—æ­£å¸¸æ›´æ–°ï¼Œä½†é¢‘çŽ‡ä¼šæ ¹æ®æ—¥å¿—é‡åŠ¨æ€è°ƒæ•´

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¥å¿—å®Œæ•´æ€§**ï¼šæ‰€æœ‰æ—¥å¿—éƒ½ä¿ç•™åœ¨ç¼“å†²åŒºä¸­ï¼Œåªæ˜¯åˆå§‹ä¸æ˜¾ç¤º
2. **å†…å­˜ç®¡ç†**ï¼šç¼“å†²åŒºå¤§å°é™åˆ¶ä¸º `MaxLogLines * 2`ï¼Œé¿å…å†…å­˜å ç”¨è¿‡å¤§
3. **å‘åŽå…¼å®¹**ï¼šåº”ç”¨å°±ç»ªåŽï¼Œæ—¥å¿—åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œä¸å½±å“åŽç»­ä½¿ç”¨
